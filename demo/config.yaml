# Constat Demo Configuration
# Run from project root: constat repl -c demo/config.yaml

# Server configuration (for API server mode)
server:
  auth_disabled: ${AUTH_DISABLED}
  firebase_project_id: ${FIREBASE_PROJECT_ID}
  # runtime_dir: .  # Base directory for .constat/ data (default: current directory)

  # User permissions - include from separate file for easier management
  permissions:
    $ref: ./permissions.yaml

# Projects keyed by identifier (used for permissions)
projects:
  sales-analytics:
    $ref: ./projects/sales-analytics.yaml
  hr-reporting:
    $ref: ./projects/hr-reporting.yaml

llm:
#  provider: ollama
#  model: qwen2.5:7b
   provider: anthropic
   model: claude-sonnet-4-20250514
   api_key: ${ANTHROPIC_API_KEY}

# Email configuration for send_email() in generated code
email:
  smtp_host: ${SMTP_HOST}
  smtp_port: ${SMTP_PORT}
  smtp_user: ${SMTP_USER}
  smtp_password: ${SMTP_PASSWORD}
  from_address: ${SMTP_FROM}
  from_name: Constat Demo
  tls: true

# SQL Databases and File-based Data Sources
databases:
  # SQL Databases (SQLite)
  inventory:
    uri: sqlite:///data/inventory.db
    description: |
      Warehouse inventory with warehouses (location, capacity, manager), inventory
      (sku, quantity, reorder_level), and shipments (direction, carrier, date).
      SKUs link to sales.products via naming convention.

  # File-based data sources (CSV, JSON, Parquet, Arrow)
#  web_metrics:
#    type: csv
#    path: data/website_metrics.csv
#    description: |
#      Daily web analytics by page (90 days). Columns: date, page, visitors,
#      page_views, bounce_rate, avg_session_duration

  events:
    type: json
    path: data/events.json
    description: |
      Clickstream events (500 records). Fields: event_id, timestamp, event_type
      (page_view/click/form_submit/purchase/signup/error), source, user_id, properties

databases_description: |
  Three interconnected business databases and two file-based data sources:
  - sales: CRM and order management (customers.tier determines discount)
  - inventory: Multi-warehouse stock management (reorder_level triggers alerts)
  - hr: Employee and performance tracking (ratings affect compensation)
  - web_metrics: Daily web analytics CSV (use file_web_metrics path)
  - events: Clickstream events JSON (use file_events path)

system_prompt: |
  You are a business analyst assistant analyzing company data.

  DOMAIN KNOWLEDGE:
  - Customer tiers: platinum (15% discount), gold (10%), silver (5%), bronze (0%)
  - Revenue recognition: Only count orders with status='delivered'
  - Inventory alerts: quantity < reorder_level triggers restock
  - Performance ratings: 5=exceptional, 4=exceeds, 3=meets, 2=needs improvement, 1=unsatisfactory

  DATA RELATIONSHIPS:
  - inventory.sku links to products by name pattern (e.g., SKU-001 = Widget thT Pro)
  - employees.manager_id is self-referential for org hierarchy
  - orders.customer_id -> customers.customer_id
  - order_items.product_id -> products.product_id

# External APIs (examples - these are public demo APIs)
apis:
  countries:
    type: graphql
    url: https://countries.trevorblades.com/graphql
    description: |
      Public GraphQL API for country data. Query countries by code,
      get continents, languages, currencies. Useful for geo-enrichment.

  catfacts:
    type: openapi
    url: https://catfact.ninja
    spec_url: https://catfact.ninja/docs
    description: |
      Cat facts and breeds API. Endpoints return paginated responses where the
      actual data is in the 'data' field (e.g., response["data"] for the array of items).
      /breeds returns breed info with country of origin. /facts returns random cat facts.

execution:
  timeout_seconds: 120
  max_retries: 5
  allowed_imports:
    - pandas
    - numpy
    - json
    - datetime
    - statistics
    - polars
    - tempfile
    - os            # File path operations
    # Standard library
    - re
    - math
    - collections
    - itertools
    - functools
    # Visualization libraries
    - plotly
    - altair
    - matplotlib
    - seaborn
    - folium
    # Document/artifact creation
    - openpyxl      # Excel files (.xlsx)
    - xlsxwriter    # Excel files with formatting
    - docx          # Word documents (.docx) - python-docx
    - pptx          # PowerPoint (.pptx) - python-pptx
    - reportlab     # PDF generation
    - pypdf         # PDF manipulation
    - PIL           # Image processing (Pillow)
    - io            # In-memory file handling
    - tabulate      # Table formatting (used by pandas to_markdown)
